<?xml version="1.0" encoding="UTF-8" ?>
<!--
  SPDX-License-Identifier: MIT
  SPDX-FileCopyrightText: 2025 nop

  CycloneDDS Unicast Configuration for Local Robot

  This configuration disables multicast and uses unicast peer discovery
  to communicate with the remote VLA inference server via Tailscale.

  Replace __PEER_IP__ with the Tailscale IP of the remote inference server,
  or use envsubst to substitute from environment variable.

  Usage:
    export CYCLONEDDS_URI=/etc/cyclonedds.xml
    export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    export REMOTE_INFERENCE_IP=100.x.x.x
    envsubst < cyclonedds-local.xml > /etc/cyclonedds.xml
-->
<CycloneDDS xmlns="https://cdds.io/config"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="https://cdds.io/config https://raw.githubusercontent.com/eclipse-cyclonedds/cyclonedds/master/etc/cyclonedds.xsd">
  <Domain Id="any">
    <General>
      <Interfaces>
        <!-- Use Tailscale interface -->
        <NetworkInterface autodetermine="true" priority="default" multicast="false" />
      </Interfaces>
      <!-- Disable multicast - required for VPN communication -->
      <AllowMulticast>false</AllowMulticast>
      <!-- Increase max message size for image data -->
      <MaxMessageSize>65500B</MaxMessageSize>
    </General>
    <Discovery>
      <Peers>
        <!-- Remote inference server's Tailscale IP -->
        <!-- Replace with actual IP or use envsubst with REMOTE_INFERENCE_IP -->
        <Peer Address="${REMOTE_INFERENCE_IP}" />
      </Peers>
      <!-- Use auto participant index to avoid port conflicts -->
      <ParticipantIndex>auto</ParticipantIndex>
    </Discovery>
    <Internal>
      <!-- Increase buffer sizes for image streaming over VPN -->
      <SocketReceiveBufferSize min="1MB" max="32MB"/>
      <SocketSendBufferSize min="1MB" max="32MB"/>
    </Internal>
  </Domain>
</CycloneDDS>
